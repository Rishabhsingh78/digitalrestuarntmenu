generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model User {
    id        String   @id @default(cuid())
    email     String   @unique
    name      String?
    country   String?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    restaurants Restaurant[]
}

model Restaurant {
    id        String   @id @default(cuid())
    name      String
    location  String
    ownerId   String
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    owner      User       @relation(fields: [ownerId], references: [id], onDelete: Cascade)
    categories Category[]
    dishes     Dish[]
}

model Category {
    id           String   @id @default(cuid())
    name         String
    restaurantId String
    createdAt    DateTime @default(now())
    updatedAt    DateTime @updatedAt

    restaurant Restaurant     @relation(fields: [restaurantId], references: [id], onDelete: Cascade)
    dishes     DishCategory[]
}

model Dish {
    id          String   @id @default(cuid())
    name        String
    description String?
    price       Float    @default(0)
    image       String?
    spiceLevel  String? // e.g. "Mild", "Medium", "Hot"
    isVeg       Boolean  @default(true)

    restaurantId String
    restaurant   Restaurant @relation(fields: [restaurantId], references: [id], onDelete: Cascade)

    categories DishCategory[]

    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model DishCategory {
    dishId     String
    categoryId String

    dish     Dish     @relation(fields: [dishId], references: [id], onDelete: Cascade)
    category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)

    @@id([dishId, categoryId])
}

model OtpCode {
    id        String   @id @default(cuid())
    email     String
    code      String
    expiresAt DateTime
    createdAt DateTime @default(now())

    @@index([email])
}
